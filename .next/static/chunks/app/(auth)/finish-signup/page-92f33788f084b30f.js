(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[591],{172:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8173:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>g});var t=r(5155),a=r(2115),n=r(5695),i=r(2400),l=r(3004),o=r(221),c=r(2177),d=r(5594),u=r(7481),m=r(6695),h=r(285),x=r(2523),w=r(7759),p=r(172);let f=d.Ik({password:d.Yj().min(8,"Password must be at least 8 characters."),confirmPassword:d.Yj()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function j(){let e=(0,n.useRouter)(),s=(0,n.useSearchParams)(),r=(0,i.As)(),{toast:d}=(0,u.dj)(),{user:j,isUserLoading:g}=(0,i.Jd)(),y=(0,i.Yq)(window.location.href),[N,P]=(0,a.useState)("loading"),[v,S]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(j||g||!y)return j&&!g?P("setPassword"):y||g||e.push("/login");P("signingIn");let s=window.localStorage.getItem("emailForSignIn");if(!s&&!(s=window.prompt("Please provide your email for confirmation"))){S("Email is required to complete sign-in."),P("error");return}try{await (0,l.hK)(r,s,window.location.href),window.localStorage.removeItem("emailForSignIn"),P("setPassword")}catch(e){console.error(e),S("Failed to sign in. The link may be invalid or expired."),P("error"),d({title:"Sign-in Error",description:v,variant:"destructive"})}})()},[y,j,g,r,e,v,d]);let b=(0,c.mN)({resolver:(0,o.u)(f),defaultValues:{password:"",confirmPassword:""}});async function k(t){if(!j){S("You must be signed in to set a password."),P("error");return}P("loading");try{await (0,l.f3)(j,t.password),setTimeout(()=>{j.email&&(0,l.J1)(r,j.email)},5e3),d({title:"Password set successfully!",description:"Redirecting..."});let a=s.get("redirectUrl")||"/dashboard";e.push(a)}catch(e){console.error(e),S("Failed to set password. Please try again."),P("error"),d({title:"Error",description:"Failed to set password.",variant:"destructive"})}}return(0,t.jsx)(m.Zp,{className:"w-full max-w-md",children:(()=>{switch(N){case"signingIn":case"loading":return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-8",children:[(0,t.jsx)(p.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Finalizing your sign-in..."})]});case"error":return(0,t.jsxs)("div",{className:"text-center p-8",children:[(0,t.jsx)(m.ZB,{className:"text-destructive",children:"Sign-in Failed"}),(0,t.jsx)(m.BT,{className:"mt-2",children:v}),(0,t.jsx)(h.$,{onClick:()=>e.push("/register"),className:"mt-4",children:"Try Again"})]});case"setPassword":return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.aR,{children:[(0,t.jsx)(m.ZB,{className:"text-2xl font-bold",children:"Set Your Password"}),(0,t.jsx)(m.BT,{children:"Welcome! To secure your account, please create a password."})]}),(0,t.jsx)(m.Wu,{children:(0,t.jsx)(w.lV,{...b,children:(0,t.jsxs)("form",{onSubmit:b.handleSubmit(k),className:"space-y-6",children:[(0,t.jsx)(w.zB,{control:b.control,name:"password",render:e=>{let{field:s}=e;return(0,t.jsxs)(w.eI,{children:[(0,t.jsx)(w.lR,{children:"New Password"}),(0,t.jsx)(w.MJ,{children:(0,t.jsx)(x.p,{type:"password",placeholder:"••••••••",...s})}),(0,t.jsx)(w.C5,{})]})}}),(0,t.jsx)(w.zB,{control:b.control,name:"confirmPassword",render:e=>{let{field:s}=e;return(0,t.jsxs)(w.eI,{children:[(0,t.jsx)(w.lR,{children:"Confirm New Password"}),(0,t.jsx)(w.MJ,{children:(0,t.jsx)(x.p,{type:"password",placeholder:"••••••••",...s})}),(0,t.jsx)(w.C5,{})]})}}),(0,t.jsx)(h.$,{type:"submit",className:"w-full",children:"Save Password & Continue"})]})})})]});default:return null}})()})}function g(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-8",children:[(0,t.jsx)(p.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,t.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Loading..."})]}),children:(0,t.jsx)(j,{})})}},9711:(e,s,r)=>{Promise.resolve().then(r.bind(r,8173))}},e=>{var s=s=>e(e.s=s);e.O(0,[992,644,277,157,315,486,858,441,684,358],()=>s(9711)),_N_E=e.O()}]);